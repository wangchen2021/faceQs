# 流式传输

## 核心定义与本质
流式传输：数据分块传输、边传边处理、无需等待完整内容，核心是 “时间换空间 + 即时响应”，区别于传统一次性下载。
关键角色：推流端（采集 / 编码）、流媒体服务器（接收 / 转码 / 分发）、拉流端（解码 / 播放）、CDN（边缘加速）。

## 传输类型
顺序流式（渐进式）	顺序下载、边下边播、不可跳播	HTTP	短视频、点播	10–30s
实时流式	实时编码分发、支持随机访问	RTMP/RTSP/WebRTC	直播、视频会议	1–5s
自适应流式（HLS/DASH）	多码率切换、适配带宽	HTTP	高清直播、点播	5–20s


结合流式传输的核心分类，下面整理**最常见的业务场景**以及对应的**主流技术选型**，每个场景都附上技术特点和适用原因，方便你快速对应技术方案：


## 一、 音视频点播（最主流的下行流式传输场景）
### 业务场景
- 视频平台：Netflix、YouTube、腾讯视频、B站的影视剧/短视频播放
- 音乐平台：Spotify、网易云音乐的在线听歌
### 核心需求
- 边下载边播放，无需等待完整文件加载
- 支持暂停、快进、后退
- 适配不同网络带宽（弱网降画质，强网提画质）
### 主流技术
1.  **HLS（HTTP Live Streaming）**
    -  特点：苹果推出的标准，将音视频切分为 10-30 秒的 TS 小文件，通过 HTTP 拉取；支持自适应码率（ABR）；兼容性极强（所有浏览器、手机、电视都支持）
    -  不足：延迟较高（10-30 秒），不适合实时直播
    -  适用：点播场景首选，如影视剧、短视频
2.  **DASH（Dynamic Adaptive Streaming over HTTP）**
    -  特点：国际标准，比 HLS 更灵活，支持更多编码格式（如 H.265、AV1）；同样支持自适应码率；切片格式可以是 MP4/TS
    -  不足：部分老旧设备兼容性略差于 HLS
    -  适用：追求高质量编码的点播平台，如 4K 视频网站

## 二、 实时直播（低延迟下行流式传输场景）
### 业务场景
- 电商直播：抖音直播、淘宝直播
- 赛事直播：体育赛事、游戏直播
- 教育直播：在线网课、企业内训
### 核心需求
- 低延迟（延迟 < 5 秒，甚至秒级）
- 支持大规模用户并发观看
- 抗网络波动，播放流畅
### 主流技术
1.  **RTMP + HLS/DASH 混合方案**
    -  流程：主播端通过 RTMP 推流到服务器 → 服务器转码为 HLS/DASH 分发给普通观众
    -  特点：RTMP 推流延迟低（1-3 秒），HLS/DASH 分发兼容性强；兼顾推流实时性和播放兼容性
    -  适用：中大型直播平台（兼顾并发和兼容性）
2.  **WebRTC**
    -  特点：基于 UDP，点对点传输，延迟极低（50-500 毫秒）；支持双向互动（如连麦）
    -  不足：大规模并发时需要搭建 SFU（选择性转发单元）服务器，成本较高
    -  适用：低延迟互动直播，如直播连麦、在线会议
3.  **LL-HLS（Low-Latency HLS）/ LL-DASH**
    -  特点：HLS/DASH 的低延迟版本，通过缩短切片时长（如 200ms）、优化传输策略，将延迟降到 1-3 秒；兼容原有 HLS/DASH 生态
    -  不足：对服务器带宽要求更高
    -  适用：需要低延迟且不想更换原有 HLS 架构的直播平台

## 三、 视频/语音通话（双向流式传输场景）
### 业务场景
- 社交通话：微信视频、FaceTime
- 在线会议：Zoom、腾讯会议、飞书会议
- 游戏语音：王者荣耀、和平精英组队语音
### 核心需求
- 超低延迟（< 300 毫秒，保证对话自然）
- 双向实时数据传输
- 抗网络抖动，弱网不掉线
### 主流技术
1.  **WebRTC**
    -  特点：浏览器原生支持，无需安装插件；基于 UDP + 拥塞控制算法，延迟极低；支持音视频编码、降噪、回声消除等内置功能；支持点对点（P2P）和 SFU 转发
    -  不足：复杂场景（如多人会议）需要服务端支持
    -  适用：所有实时双向音视频场景，是该领域的事实标准
2.  **SRTP（Secure Real-time Transport Protocol）**
    -  特点：基于 RTP 的加密版本，保证音视频数据传输安全
    -  适用：对安全性要求高的场景，如企业会议、金融远程面签

## 四、 大文件上传/下载（文件流式传输场景）
### 业务场景
- 网盘服务：百度网盘、阿里云盘的 GB 级文件传输
- 云存储：AWS S3、阿里云 OSS 的文件上传下载
- 软件更新：操作系统、大型游戏的更新包下载
### 核心需求
- 断点续传（网络中断后无需重新传输）
- 分块传输（避免单次传输过大导致超时）
- 传输进度实时反馈
### 主流技术
1.  **HTTP 分块传输（Chunked Transfer Encoding）**
    -  特点：HTTP 1.1 原生支持，服务端/客户端将文件切分为小块，标记 `Transfer-Encoding: chunked` 头信息，分块传输
    -  适用：服务端向客户端流式返回大型数据（如导出百万级数据的 CSV 文件）
2.  **分片上传 + 断点续传（自定义 HTTP 方案）**
    -  流程：客户端将文件切分为固定大小的分片（如 5MB/片）→ 并发上传分片 → 服务端接收后合并 → 上传中断时，仅重传失败的分片
    -  核心技术：基于 HTTP POST/PUT，配合自定义的分片标识、进度校验逻辑
    -  适用：大文件上传场景（网盘、云存储）
3.  **FTP/SFTP（传统文件传输协议）**
    -  特点：专用的文件传输协议，支持流式传输和断点续传
    -  不足：需要专用客户端，浏览器不支持；安全性较低（SFTP 是 SSH 加密版本，更安全）
    -  适用：后台系统的文件批量传输（如服务器日志备份）

## 五、 实时数据推送/同步（数据流式传输场景）
### 业务场景
- 实时监控：服务器监控指标、物联网传感器数据上报
- 实时通知：社交平台的消息推送、订单状态更新
- 大数据同步：数据库 binlog 同步、Flink/Spark 流式计算
### 主流技术
1.  **Server-Sent Events（SSE）**
    -  特点：基于 HTTP 单向流式传输，服务端向客户端推送数据；浏览器原生支持（`EventSource` API）；轻量级，无需额外依赖
    -  不足：仅支持单向传输（服务端→客户端）；最大并发数受限于浏览器 HTTP 连接数
    -  适用：服务端向客户端单向推送实时数据，如监控面板、实时通知
2.  **WebSocket**
    -  特点：基于 HTTP 握手，建立双向 TCP 连接；支持全双工通信（客户端↔服务端）；无同源限制（需服务端配置）
    -  不足：长连接会占用服务器资源；需要处理断线重连逻辑
    -  适用：双向实时数据交互，如聊天室、实时协同编辑、游戏实时状态同步
3.  **CDC（Change Data Capture）技术**
    -  特点：监听数据库的变更日志（如 MySQL binlog、PostgreSQL WAL），将变更数据流式同步到下游系统
    -  主流工具：Debezium、Canal
    -  适用：大数据场景的实时数据同步，如电商订单数据实时同步到数仓

## 六、 前端页面流式渲染（特殊的 Web 流式场景）
### 业务场景
- 大型电商页面：淘宝首页、京东商品详情页
- 服务端渲染（SSR）：Next.js、Nuxt.js 应用的流式渲染
### 核心需求
- 页面分块渲染，优先展示首屏内容，提升用户体验
- 减少首屏加载时间（TTFP）
### 主流技术
1.  **HTML 流式传输（Chunked HTML）**
    -  特点：服务端分块生成 HTML，先发送首屏内容（如导航、商品列表），再发送非首屏内容（如评论、推荐）；浏览器接收一块渲染一块
    -  适用：服务端渲染（SSR）应用，如 Next.js 的 `getServerSideProps` 流式渲染
2.  **React Server Components（RSC）**
    -  特点：React 18+ 特性，服务端组件的渲染结果以流式数据的形式传输到客户端，客户端增量渲染
    -  适用：React 大型应用的流式渲染，提升首屏加载速度

## 总结：场景与技术对应速查表
| 业务场景         | 核心需求                | 首选技术                     | 次选技术                     |
|------------------|-------------------------|------------------------------|------------------------------|
| 音视频点播       | 边播边下、自适应码率    | HLS                          | DASH                         |
| 实时直播         | 低延迟、高并发          | RTMP + HLS / LL-HLS          | WebRTC（互动直播）           |
| 视频/语音通话    | 超低延迟、双向互动      | WebRTC                       | SRTP（加密场景）             |
| 大文件上传/下载  | 断点续传、分块传输      | 分片上传（HTTP）/ 分块下载   | SFTP（后台传输）             |
| 实时数据推送     | 单向实时更新            | SSE                          | WebSocket（需双向时）        |
| 实时数据交互     | 双向实时同步            | WebSocket                    | -                            |
| 前端流式渲染     | 首屏优先、增量渲染      | HTML 流式传输 / React RSC    | -                            |